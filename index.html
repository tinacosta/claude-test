<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soprano Ornamentation Exercises</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 13px;
        }

        .exercise-selector {
            margin-bottom: 20px;
        }

        .exercise-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .display-area {
            background: #1a1a2e;
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            min-height: 200px;
            text-align: center;
        }

        .current-note {
            font-size: 60px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #ffd700;
        }

        .info {
            font-size: 18px;
            color: #87CEEB;
            margin: 10px 0;
        }

        .status {
            font-size: 14px;
            color: #aaa;
            margin-top: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            min-width: 120px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .btn-pause {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn-stop {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .guidance-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .primer-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .guidance-label {
            font-size: 12px;
            font-weight: 700;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .primer-label {
            font-size: 12px;
            font-weight: 700;
            color: #ff9800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .primer-text {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            font-family: 'Courier New', monospace;
        }

        .syllables {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .technique {
            font-size: 13px;
            color: #555;
            line-height: 1.5;
        }

        .tempo-control {
            margin-bottom: 20px;
            text-align: center;
        }

        .tempo-control input {
            width: 100%;
            margin: 10px 0;
        }

        .tempo-value {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Soprano Ornamentation Exercises</h1>
        <p class="subtitle">D3 to D6 Range â€¢ 10 Advanced Exercises</p>

        <div class="exercise-selector">
            <select id="exercise-select">
                <option value="scale">Chromatic Scale (C4-D6-D3)</option>
                <option value="trill">Baroque Trill - Italian Style</option>
                <option value="portamento">Bel Canto Portamento</option>
                <option value="run">Coloratura Run</option>
                <option value="messa">Messa di Voce with Turn</option>
                <option value="appoggiatura">Appoggiatura Sequence</option>
                <option value="jazz">Jazz Scoop and Fall</option>
                <option value="french">French Ornamental Grace Notes</option>
                <option value="mordent">German Lieder Mordent</option>
                <option value="melisma">Spanish Melisma</option>
                <option value="staccato">Staccato Pearls (Perlen)</option>
            </select>
        </div>

        <div class="primer-box">
            <div class="primer-label">Exercise Pattern</div>
            <div class="primer-text" id="primer-text">Chromatic scale: 1, â™¯1/â™­2, 2, â™¯2/â™­3, 3, 4, â™¯4/â™­5, 5, â™¯5/â™­6, 6, â™¯6/â™­7, 7, 8... Ascending by half steps with breath between each step, then descending.</div>
        </div>

        <div class="guidance-box">
            <div class="guidance-label">Syllables to Sing</div>
            <div class="syllables" id="syllables-text">ma, me, mi, mo, mu</div>
            <div class="guidance-label">Technique</div>
            <div class="technique" id="technique-text">Keep throat open and relaxed. Support from the diaphragm. Maintain consistent tone quality throughout the range. Focus on smooth transitions between registers.</div>
        </div>

        <div class="tempo-control">
            <div>Tempo: <span class="tempo-value" id="tempo-value">80 BPM</span></div>
            <input type="range" id="tempo-slider" min="60" max="140" value="80" step="10">
        </div>

        <div class="display-area">
            <div class="current-note" id="current-note">â€”</div>
            <div class="info" id="info-text">Select exercise and tap Start</div>
            <div class="status" id="status-text">Ready</div>
        </div>

        <div class="controls">
            <button class="btn-start" id="btn-start">Start Exercise</button>
            <button class="btn-pause" id="btn-pause" disabled>Pause</button>
            <button class="btn-stop" id="btn-stop" disabled>Stop</button>
        </div>
    </div>

    <script>
        // Simple Web Audio API implementation for mobile compatibility
        let audioContext = null;
        let isPlaying = false;
        let isPaused = false;
        let currentTimeout = null;
        let tempo = 80;
        let currentNoteIndex = 0;
        let currentExercise = 'scale';

        // Note frequencies
        const notes = {
            'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00, 'G#3': 207.65,
            'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63,
            'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00,
            'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 'E5': 659.25,
            'F5': 698.46, 'F#5': 739.99, 'G5': 783.99, 'G#5': 830.61, 'A5': 880.00,
            'A#5': 932.33, 'B5': 987.77,
            'C6': 1046.50, 'C#6': 1108.73, 'D6': 1174.66
        };

        // Exercise patterns
        const exercises = {
            scale: {
                name: 'Chromatic Scale',
                notes: ['C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4',
                       'C5', 'C#5', 'D5', 'D#5', 'E5', 'F5', 'F#5', 'G5', 'G#5', 'A5', 'A#5', 'B5',
                       'C6', 'C#6', 'D6',
                       'C#6', 'C6', 'B5', 'A#5', 'A5', 'G#5', 'G5', 'F#5', 'F5', 'E5', 'D#5', 'D5', 'C#5', 'C5',
                       'B4', 'A#4', 'A4', 'G#4', 'G4', 'F#4', 'F4', 'E4', 'D#4', 'D4', 'C#4', 'C4',
                       'B3', 'A#3', 'A3', 'G#3', 'G3', 'F#3', 'F3', 'E3', 'D#3', 'D3'],
                duration: 0.5,
                syllables: ['ma', 'me', 'mi', 'mo', 'mu'],
                technique: 'Keep throat open and relaxed. Support from the diaphragm. Maintain consistent tone quality throughout the range. Focus on smooth transitions between registers.',
                primer: 'Chromatic scale: 1, â™¯1/â™­2, 2, â™¯2/â™­3, 3, 4, â™¯4/â™­5, 5, â™¯5/â™­6, 6, â™¯6/â™­7, 7, 8... Ascending by half steps with breath between each step, then descending.'
            },
            trill: {
                name: 'Baroque Trill - Italian Style',
                notes: ['C4', 'D4', 'C4', 'D4', 'E4', 'F4', 'E4', 'F4', 'G4', 'A4', 'G4', 'A4',
                       'B4', 'C5', 'B4', 'C5', 'D5', 'E5', 'D5', 'E5', 'F5', 'G5', 'F5', 'G5',
                       'A5', 'B5', 'A5', 'B5', 'C6', 'D6', 'C6', 'D6'],
                duration: 0.3,
                syllables: ['i', 'e', 'a'],
                technique: 'Classic upper-neighbor trill starting slowly and accelerating. Emphasize clarity and evenness. Keep the throat free and let rapid motion come from the vocal cords.',
                primer: 'Upper-neighbor trill: 1-2-1-2, then move up a step. Pattern: do-re-do-re, mi-fa-mi-fa, sol-la-sol-la...'
            },
            portamento: {
                name: 'Bel Canto Portamento',
                notes: ['C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4',
                       'D4', 'F4', 'A4', 'D5', 'A4', 'F4', 'D4',
                       'E5', 'G5', 'B5', 'E5', 'D6', 'B5', 'G5'],
                duration: 0.6,
                syllables: ['o', 'u', 'a'],
                technique: 'Smooth gliding between notes with connected tone. Focus on seamless legato. Imagine a ribbon of sound connecting each note without breaks.',
                primer: 'Arpeggios with smooth connection: 1-3-5-8-5-3-1. Major triads ascending through range (do-mi-sol-do...)'
            },
            run: {
                name: 'Coloratura Run',
                notes: ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4',
                       'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'D5', 'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4',
                       'E5', 'F5', 'G5', 'A5', 'B5', 'C6', 'D6'],
                duration: 0.22,
                syllables: ['a', 'i'],
                technique: 'Rapid scale passages requiring agility and precision. Keep throat open and relaxed. Each note clear but connected like pearls on a string.',
                primer: 'Fast diatonic runs: ascending 1-2-3-4-5-6-7-8, then descending, then ascending higher. Major scale patterns (do-re-mi-fa-sol-la-ti-do)'
            },
            messa: {
                name: 'Messa di Voce with Turn',
                notes: ['C4', 'D4', 'C4', 'B3', 'C4',
                       'E4', 'F4', 'E4', 'D4', 'E4',
                       'G4', 'A4', 'G4', 'F4', 'G4',
                       'C5', 'D5', 'C5', 'B4', 'C5',
                       'E5', 'F5', 'E5', 'D5', 'E5',
                       'A5', 'B5', 'A5', 'G5', 'A5',
                       'D6', 'C6', 'D6', 'C6', 'D6'],
                duration: 0.45,
                syllables: ['a', 'e', 'o'],
                technique: 'Crescendo-decrescendo on sustained notes with ornamental turn. Master dynamic control while maintaining steady breath support. Expand then diminish the tone smoothly.',
                primer: 'Turn around main note: 1-2-1-â™­7-1. Pattern on each scale degree with dynamic swell (do-re-do-ti-do with crescendo-diminuendo)'
            },
            appoggiatura: {
                name: 'Appoggiatura Sequence',
                notes: ['D4', 'C4', 'F4', 'E4', 'A4', 'G4',
                       'C5', 'B4', 'E5', 'D5', 'G5', 'F5',
                       'B5', 'A5', 'D6', 'C6'],
                duration: 0.4,
                syllables: ['e', 'o'],
                technique: 'Leaning notes resolving downward. Stress the appoggiatura with a slight accent, then release smoothly to the resolution. Express the tension and release.',
                primer: 'Leaning note resolution: 2-1, 4-3, 6-5, 8-7... Each dissonance resolves down by step (re-do, fa-mi, la-sol...)'
            },
            jazz: {
                name: 'Jazz Scoop and Fall',
                notes: ['A3', 'C4', 'E4', 'G4', 'E4',
                       'B3', 'D4', 'F4', 'A4', 'F4',
                       'C4', 'E4', 'G4', 'C5', 'G4',
                       'E5', 'G5', 'B5', 'D6', 'B5'],
                duration: 0.5,
                syllables: ['a', 'oh', 'yeah'],
                technique: 'Slide into and out of notes with style. Use vibrato at the peak. Channel the freedom and expressiveness of jazz phrasing.',
                primer: 'Scoop up to chord tones: 6-1-3-5-3, 7-2-4-6-4... Glide into arpeggios with fall-offs (la-do-mi-sol-mi with slides)'
            },
            french: {
                name: 'French Ornamental Grace Notes',
                notes: ['B3', 'C4', 'D4', 'E4',
                       'E4', 'F4', 'F4', 'G4',
                       'A4', 'B4', 'B4', 'C5',
                       'D5', 'E5', 'F5', 'G5',
                       'A5', 'B5', 'C6', 'D6'],
                duration: 0.35,
                syllables: ['i', 'u'],
                technique: 'Delicate grace notes before main tones. Light and articulate, like Couperin. Quick and elegant with refined articulation.',
                primer: 'Grace note before main note: â™­7-1, 2-3, 4-5... Quick ornamental approach from below (ti-do, re-mi, fa-sol...)'
            },
            mordent: {
                name: 'German Lieder Mordent',
                notes: ['C4', 'B3', 'C4', 'E4', 'D4', 'E4',
                       'G4', 'F4', 'G4', 'C5', 'B4', 'C5',
                       'E5', 'D5', 'E5', 'G5', 'F5', 'G5',
                       'B5', 'A5', 'B5', 'D6', 'C6', 'D6'],
                duration: 0.35,
                syllables: ['Ã¤', 'Ã¶', 'a'],
                technique: 'Quick alternation with lower neighbor. Expressive and speech-like. Channel the emotional depth of German Romantic song.',
                primer: 'Lower-neighbor mordent: 1-â™­7-1, 3-2-3, 5-4-5, 8-7-8... Main note with quick dip below (do-ti-do, mi-re-mi...)'
            },
            melisma: {
                name: 'Spanish Melisma',
                notes: ['C4', 'D4', 'E4', 'G4', 'A4', 'G4', 'E4', 'C4',
                       'E4', 'F4', 'G4', 'B4', 'C5', 'B4', 'G4', 'E4',
                       'G5', 'A5', 'B5', 'D6', 'B5', 'A5', 'G5'],
                duration: 0.28,
                syllables: ['a', 'ay', 'e'],
                technique: 'Flowing melismatic passages with passion. Channel flamenco ornamentation. Let the notes cascade with energy and expression.',
                primer: 'Flowing scale fragments: 1-2-3-5-6-5-3-1... Cascading patterns ascending through range (do-re-mi-sol-la-sol-mi-do)'
            },
            staccato: {
                name: 'Staccato Pearls (Perlen)',
                notes: ['C4', 'E4', 'G4', 'B4', 'D5', 'F5', 'A5', 'C6', 'D6',
                       'C6', 'A5', 'F5', 'D5', 'B4', 'G4', 'E4', 'C4'],
                duration: 0.2,
                syllables: ['a', 'i'],
                technique: 'Brilliant staccato notes like pearls on a string. Light, precise, and dazzling. Think Queen of the Night - each note sparkles individually.',
                primer: 'Staccato arpeggios: 1-3-5-7-9-11-13-15... Ascending thirds with brilliant articulation (do-mi-sol-ti-re-fa-la-do-re)'
            }
        };

        // Initialize audio context on user interaction
        async function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // Resume if suspended (iOS requirement)
            if (audioContext.state === 'suspended') {
                await audioContext.resume();
            }
            return audioContext.state === 'running';
        }

        // Play a single note
        function playTone(frequency, duration) {
            if (!audioContext || audioContext.state !== 'running') {
                return duration * 1000;
            }

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';

            const now = audioContext.currentTime;
            const noteDuration = duration * (60 / tempo);

            // Simple envelope
            gainNode.gain.setValueAtTime(0, now);
            gainNode.gain.linearRampToValueAtTime(0.5, now + 0.02);
            gainNode.gain.linearRampToValueAtTime(0.4, now + noteDuration - 0.05);
            gainNode.gain.linearRampToValueAtTime(0, now + noteDuration);

            oscillator.start(now);
            oscillator.stop(now + noteDuration);

            return noteDuration * 1000;
        }

        // Play next note in sequence
        function playNextNote() {
            if (!isPlaying || isPaused) return;

            const exercise = exercises[currentExercise];

            if (currentNoteIndex >= exercise.notes.length) {
                stopExercise();
                updateStatus('Exercise complete!');
                updateNote('âœ“');
                updateInfo('Well done!');
                return;
            }

            const noteName = exercise.notes[currentNoteIndex];
            const frequency = notes[noteName];

            updateNote(noteName);
            updateInfo(`Note ${currentNoteIndex + 1} of ${exercise.notes.length}`);

            // Check if we need a breathing pause (chromatic scale going up)
            const needsBreath = currentExercise === 'scale' && currentNoteIndex > 0;
            if (needsBreath) {
                const prevNoteName = exercise.notes[currentNoteIndex - 1];
                const prevFrequency = notes[prevNoteName];
                const isAscending = frequency > prevFrequency;

                if (isAscending) {
                    updateStatus('Breathe...');
                    currentTimeout = setTimeout(() => {
                        updateStatus('Playing...');
                        const duration = playTone(frequency, exercise.duration);
                        currentNoteIndex++;
                        currentTimeout = setTimeout(() => {
                            playNextNote();
                        }, duration);
                    }, 800); // 800ms breathing pause
                    return;
                }
            }

            updateStatus('Playing...');
            const duration = playTone(frequency, exercise.duration);

            currentNoteIndex++;

            currentTimeout = setTimeout(() => {
                playNextNote();
            }, duration);
        }

        // Start exercise
        async function startExercise() {
            await initAudio();

            if (isPaused) {
                isPaused = false;
                isPlaying = true;
                updateButtons();
                playNextNote();
                return;
            }

            isPlaying = true;
            isPaused = false;
            currentNoteIndex = 0;

            const exercise = exercises[currentExercise];
            updateInfo(`${exercise.name}`);
            updateStatus('Playing...');

            updateButtons();
            playNextNote();
        }

        // Pause exercise
        function pauseExercise() {
            isPaused = true;
            isPlaying = false;
            if (currentTimeout) clearTimeout(currentTimeout);
            updateStatus('Paused');
            updateButtons();
        }

        // Stop exercise
        function stopExercise() {
            isPlaying = false;
            isPaused = false;
            if (currentTimeout) clearTimeout(currentTimeout);
            currentNoteIndex = 0;
            updateNote('â€”');
            updateStatus('Stopped');
            updateInfo('Select exercise and tap Start');
            updateButtons();
        }

        // Update UI
        function updateNote(note) {
            document.getElementById('current-note').textContent = note;
        }

        function updateInfo(text) {
            document.getElementById('info-text').textContent = text;
        }

        function updateStatus(text) {
            document.getElementById('status-text').textContent = text;
        }

        function updateButtons() {
            document.getElementById('btn-start').disabled = isPlaying;
            document.getElementById('btn-pause').disabled = !isPlaying;
            document.getElementById('btn-stop').disabled = !isPlaying && !isPaused;
        }

        function updateGuidance() {
            const exercise = exercises[currentExercise];
            document.getElementById('syllables-text').textContent = exercise.syllables.join(', ');
            document.getElementById('technique-text').textContent = exercise.technique;
        }

        function updatePrimer() {
            const exercise = exercises[currentExercise];
            document.getElementById('primer-text').textContent = exercise.primer;
        }

        // Event listeners
        document.getElementById('btn-start').addEventListener('click', startExercise);
        document.getElementById('btn-pause').addEventListener('click', pauseExercise);
        document.getElementById('btn-stop').addEventListener('click', stopExercise);

        document.getElementById('exercise-select').addEventListener('change', (e) => {
            currentExercise = e.target.value;
            stopExercise();
            const exercise = exercises[currentExercise];
            updateInfo(`Selected: ${exercise.name}`);
            updateGuidance();
            updatePrimer();
        });

        document.getElementById('tempo-slider').addEventListener('input', (e) => {
            tempo = parseInt(e.target.value);
            document.getElementById('tempo-value').textContent = tempo + ' BPM';
        });

        // Initialize
        updateButtons();
        updateGuidance();
        updatePrimer();
    </script>
</body>
</html>

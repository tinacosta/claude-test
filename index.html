<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soprano Ornamentation Exercises</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 13px;
        }

        .exercise-selector {
            margin-bottom: 20px;
        }

        .exercise-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .display-area {
            background: #1a1a2e;
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            min-height: 200px;
            text-align: center;
        }

        .current-note {
            font-size: 60px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #ffd700;
        }

        .info {
            font-size: 18px;
            color: #87CEEB;
            margin: 10px 0;
        }

        .status {
            font-size: 14px;
            color: #aaa;
            margin-top: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            min-width: 120px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-start {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .btn-pause {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn-stop {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .tempo-control {
            margin-bottom: 20px;
            text-align: center;
        }

        .tempo-control input {
            width: 100%;
            margin: 10px 0;
        }

        .tempo-value {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Soprano Ornamentation Exercises</h1>
        <p class="subtitle">C4 to D6 Range â€¢ Tap Start to Begin</p>

        <div class="exercise-selector">
            <select id="exercise-select">
                <option value="scale">Simple Scale (C4-D6-A3)</option>
                <option value="trill">Baroque Trill</option>
                <option value="run">Coloratura Run</option>
                <option value="portamento">Bel Canto Portamento</option>
            </select>
        </div>

        <div class="tempo-control">
            <div>Tempo: <span class="tempo-value" id="tempo-value">80 BPM</span></div>
            <input type="range" id="tempo-slider" min="60" max="140" value="80" step="10">
        </div>

        <div class="display-area">
            <div class="current-note" id="current-note">â€”</div>
            <div class="info" id="info-text">Select exercise and tap Start</div>
            <div class="status" id="status-text">Ready</div>
        </div>

        <div class="controls">
            <button class="btn-start" id="btn-start">Start Exercise</button>
            <button class="btn-pause" id="btn-pause" disabled>Pause</button>
            <button class="btn-stop" id="btn-stop" disabled>Stop</button>
        </div>
    </div>

    <script>
        // Simple Web Audio API implementation for mobile compatibility
        let audioContext = null;
        let isPlaying = false;
        let isPaused = false;
        let currentTimeout = null;
        let tempo = 80;
        let currentNoteIndex = 0;
        let currentExercise = 'scale';

        // Note frequencies
        const notes = {
            'A3': 220.00, 'B3': 246.94,
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
            'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77,
            'C6': 1046.50, 'D6': 1174.66
        };

        // Exercise patterns
        const exercises = {
            scale: {
                name: 'Simple Scale',
                notes: ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'D5', 'E5', 'F5', 'G5', 'A5', 'B5', 'C6', 'D6',
                       'C6', 'B5', 'A5', 'G5', 'F5', 'E5', 'D5', 'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4', 'C4', 'B3', 'A3'],
                duration: 0.5
            },
            trill: {
                name: 'Baroque Trill',
                notes: ['C4', 'D4', 'C4', 'D4', 'E4', 'F4', 'E4', 'F4', 'G4', 'A4', 'G4', 'A4',
                       'B4', 'C5', 'B4', 'C5', 'D5', 'E5', 'D5', 'E5', 'F5', 'G5', 'F5', 'G5',
                       'A5', 'B5', 'A5', 'B5', 'C6', 'D6', 'C6', 'D6'],
                duration: 0.3
            },
            run: {
                name: 'Coloratura Run',
                notes: ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4', 'C4',
                       'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5', 'D5', 'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4',
                       'E5', 'F5', 'G5', 'A5', 'B5', 'C6', 'D6'],
                duration: 0.25
            },
            portamento: {
                name: 'Bel Canto Portamento',
                notes: ['C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4',
                       'D4', 'F4', 'A4', 'D5', 'A4', 'F4', 'D4',
                       'E5', 'G5', 'B5', 'E5', 'D6', 'B5', 'G5'],
                duration: 0.6
            }
        };

        // Initialize audio context on user interaction
        async function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                updateStatus('Audio context created: ' + audioContext.state);
            }
            // Resume if suspended (iOS requirement)
            if (audioContext.state === 'suspended') {
                updateStatus('Resuming audio context...');
                await audioContext.resume();
                updateStatus('Audio context state: ' + audioContext.state);
            }
            return audioContext.state === 'running';
        }

        // Play a single note
        function playTone(frequency, duration) {
            if (!audioContext) {
                updateStatus('ERROR: No audio context');
                return duration * 1000;
            }

            if (audioContext.state !== 'running') {
                updateStatus('ERROR: Audio context not running: ' + audioContext.state);
                return duration * 1000;
            }

            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';

                const now = audioContext.currentTime;
                const noteDuration = duration * (60 / tempo);

                // Simple envelope with higher volume
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.5, now + 0.02);
                gainNode.gain.linearRampToValueAtTime(0.4, now + noteDuration - 0.05);
                gainNode.gain.linearRampToValueAtTime(0, now + noteDuration);

                oscillator.start(now);
                oscillator.stop(now + noteDuration);

                return noteDuration * 1000;
            } catch (error) {
                updateStatus('ERROR playing: ' + error.message);
                return duration * 1000;
            }
        }

        // Play next note in sequence
        function playNextNote() {
            if (!isPlaying || isPaused) return;

            const exercise = exercises[currentExercise];

            if (currentNoteIndex >= exercise.notes.length) {
                stopExercise();
                updateStatus('Exercise complete!');
                updateNote('âœ“');
                updateInfo('Well done!');
                return;
            }

            const noteName = exercise.notes[currentNoteIndex];
            const frequency = notes[noteName];

            updateNote(noteName);
            updateInfo(`Note ${currentNoteIndex + 1} of ${exercise.notes.length}`);
            updateStatus('Playing...');

            const duration = playTone(frequency, exercise.duration);

            currentNoteIndex++;

            currentTimeout = setTimeout(() => {
                playNextNote();
            }, duration);
        }

        // Start exercise
        async function startExercise() {
            updateStatus('Initializing audio...');

            const audioReady = await initAudio();

            if (!audioReady) {
                updateStatus('ERROR: Audio failed to start. State: ' + (audioContext ? audioContext.state : 'no context'));
                alert('Audio failed to initialize.\n\nMake sure:\n1. Volume is turned up\n2. Silent mode is OFF\n3. Try refreshing the page');
                return;
            }

            if (isPaused) {
                isPaused = false;
                isPlaying = true;
                updateButtons();
                playNextNote();
                return;
            }

            isPlaying = true;
            isPaused = false;
            currentNoteIndex = 0;

            const exercise = exercises[currentExercise];
            updateInfo(`Starting: ${exercise.name}`);
            updateStatus('Audio ready! Playing...');

            updateButtons();

            // Play first note immediately
            playNextNote();
        }

        // Pause exercise
        function pauseExercise() {
            isPaused = true;
            isPlaying = false;
            if (currentTimeout) clearTimeout(currentTimeout);
            updateStatus('Paused');
            updateButtons();
        }

        // Stop exercise
        function stopExercise() {
            isPlaying = false;
            isPaused = false;
            if (currentTimeout) clearTimeout(currentTimeout);
            currentNoteIndex = 0;
            updateNote('â€”');
            updateStatus('Stopped');
            updateInfo('Select exercise and tap Start');
            updateButtons();
        }

        // Update UI
        function updateNote(note) {
            document.getElementById('current-note').textContent = note;
        }

        function updateInfo(text) {
            document.getElementById('info-text').textContent = text;
        }

        function updateStatus(text) {
            document.getElementById('status-text').textContent = text;
        }

        function updateButtons() {
            document.getElementById('btn-start').disabled = isPlaying;
            document.getElementById('btn-pause').disabled = !isPlaying;
            document.getElementById('btn-stop').disabled = !isPlaying && !isPaused;
        }

        // Event listeners
        document.getElementById('btn-start').addEventListener('click', startExercise);
        document.getElementById('btn-pause').addEventListener('click', pauseExercise);
        document.getElementById('btn-stop').addEventListener('click', stopExercise);

        document.getElementById('exercise-select').addEventListener('change', (e) => {
            currentExercise = e.target.value;
            stopExercise();
            const exercise = exercises[currentExercise];
            updateInfo(`Selected: ${exercise.name}`);
        });

        document.getElementById('tempo-slider').addEventListener('input', (e) => {
            tempo = parseInt(e.target.value);
            document.getElementById('tempo-value').textContent = tempo + ' BPM';
        });

        // Initialize
        updateButtons();
    </script>
</body>
</html>
